# 12.Promise封装读取文件

### 一般写法

```js
// 1. 引用 fs 模块
const fs = require("fs");

// 2. 调用方法，读取文件
fs.readFile("text.txt", (err, data) => {
    // 如果失败则抛出错误
    if(err) throw err;
    // 如果没有出错，则输出内容
    console.log(data.toString());
})
```

```js
const fs = require("fs");

const p = new Promise(function(res, rej) {
    fs.readFile("text.txt", (err, data) => {
        if(err) rej(err);
        res(data);
    })
});

p.then(function(value) {
    console.log(value.toString());
}, function(reason) {
    console.log(reason);
})
```

## Promise封装Ajax请求

>  请求地址: https://api.apiopen.top/getJoke

### 原生请求

```js
// 1. 创建对象
const xhr = new XMLHttpRequest();

// 2. 初始化
xhr.open("GET", "https://api.apiopen.top/getJoke");

// 3. 发送
xhr.send();

// 4. 绑定事件，处理相应结果
xhr.onreadystatechange = function() {
    if(xhr.readyState == 4) {
        // 判断相应状态码 200-299
        if(xhr.status >= 200 && xhr.status <= 299) {
            // 成功
            console.log(xhr.response);
        } else {
            // 失败
            console.error(xhr.status);
        }
    }
}
```

```js
const p = new Promise(function(resolve, reject) {
    const xhr = new XMLHttpRequest();
    xhr.open("GET", "https://api.apiopen.top/getJoke");
    xhr.send();

    xhr.onreadystatechange = function() {
        if(xhr.readyState == 4) {
            if(xhr.status >= 200 && xhr.status <= 299) {
                resolve(xhr.response);
            } else {
                reject(xhr.status);
            }
        }
    }
});

p.then(function(value) {
    console.log(value.toString());
}, function(reason) {
    console.error(reason);
});
```

调用then方法返回的结果是一个promise对象

1. 如果返回的值是一个非promise的结果，那么他的状态只能是成功

```js
const p = new Promise(function(resolve, reject) {
    setTimeout(() => {
        resolve("用户数据");
        // reject("失败了")
    }, 1000);
});

var result = p.then(value => {
    console.log(value.toString);
    // return "hello";
    return new Promise((resolve, reject) => {
        // resolve("成功了");
        reject("失败")
    });
    // throw new Error("失败")
}, reason => {
    console.error(reason);
});
console.log(result);
```

